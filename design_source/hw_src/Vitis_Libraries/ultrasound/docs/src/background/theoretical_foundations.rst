.. 
   .. Copyright © 2019–2023 Advanced Micro Devices, Inc

`Terms and Conditions <https://www.amd.com/en/corporate/copyright>`_.

Theoretical foundations
=======================

.. toctree::
   :hidden:
   :maxdepth: 1

Plane Wave and Synthetic Aperture formulation
---------------------------------------------

Introduction
------------

To ease the comprehension of the **Advanced Ultrasound Imaging Toolbox**, it is essential for the reader to understand the theory behind the libraries and the possible range of applications.

This Beamformer works with 3D data input *axial*, *lateral*, and *elevation*, captured from ultrasound transducers to produce a visible image of the region impinged by ultrasonic waves. There are two modalities specific of this library: **Synthetic Aperture Imaging** (*SA* from now on), and **Plane Wave Imaging** (*PW* form now on). The Beamformer however can be used with other imaging technique such as flow imaging.

In ultrasound medical imaging, beamforming captures the spatial distribution of the acoustic waves pressure field amplitude in the volume of interest elaborating the signals generated by an ultrasonic transducer, reflected by an anatomic part as scattered waves, and received by the same ultrasonic transducer, for the purpose of generating images.

There are several parameters that affect the final image quality:

**Spatial resolution:** The smallest spatial distance for which two scatterers can be distinguished in the final image. Spatial resolution can be either axial (along the direction of propagation of the ultrasound wave), lateral, or elevation resolution (along the plane to which the direction of propagation is perpendicular). This feature is normally expressed in mm.

**Temporal resolution:** The time interval between two consecutive images. This feature is normally
expressed in Hz.

**Contrast:** The capability to visually delineate different objects, for example, different tissue types, in the
generated images. This feature is generally expressed in dB, and it is a relative measure between
image intensities.

**Penetration depth:** The larger depths for which a sufficiently high signal-to-noise ratio (SNR)
level can be maintained. This feature is normally expressed in cm.

**Array aperture:** The physical sizes of the surface representing the combined distribution of active and passive ultrasound sensors: in other words, the array footprint. The array aperture is defined by the number of ultrasound sensors (elements), their sizes, and their distribution. This feature is generally expressed in cm2.

**Field of view (FOV):** The sizes of the area represented by the obtained images. This feature is
generally expressed in cm2 or cm3.

All such features are correlated and interdependent.

Synthetic Aperture Formulation
------------------------------

Synthetic aperture techniques were originally conceived for radar systems. There are many similarities between Radar and ultrasound systems, but there are significant differences as well.

SA Radar systems usually employ one transmitter and receiver, and the aperture in synthesized by moving the antenna over the region of interest in an airplane or satellite.

In medical ultrasound, the array has a fixed number of elements and is usually stationary.

For Radar, the object is most often in the far-field of the array.

For a medical ultrasound system, the object is always in the near-field of the array, which complicates the reconstruction.

Since the medical array is stationary, it is possible to repeat measurements rapidly, which is not the case for an SA Radar systems. The position between the different elements is also fixed in ultrasound, whereas the deviations from a straight flight path for airplane often have to be compensated for in Radar systems.

A vital difference is also that the dynamic range in a Radar image is significantly less than the 40–80 dB dynamic range in ultrasound images.

SA technique consists in exciting a one (or more) transducers to emit an *unfocused* spherical wave covering the full image region. The received signals for all or part of the elements in the aperture are sampled for each transmission. This data is used for making a **Low Resolution Image** (*LRI* from now on), from the received radio-frequency data (*RF-data*) are then obtained by the value registered by all the transducers available in the ultrasound probe.
LRI is a noisy image and to improve the image quality, SA performs multiple emissions to obtain a corresponding set of LRIs. For example, if the SA performs seven emissions, the Beamformer must create 7 LRIs.
The LRIs received must be compounded in a single image, creating a **High Resolution Image** (*HRI* from now on). Higher the number of emissions higher the quality of the image, until an SNR limit is reached beyond that there is no percived quality improvement. The HRI image is then displayed on a healthcare monitor. Every HRI created is counted as a frame in this imaging technique. To be clearer, if we need 30 FPS, we must create 30 HRIs every second. To bind this concept with the LRIs, if you perform seven emissions per HRI with a fixed frame rate of 30 FPS, you need to perform seven emissions per frame and; hence, you need to create 7*30=210 LRIs. The LRIs are going then to be compounded by groups of seven, every 1/30 seconds to achieve the fixed frame rate of 30fps. The following image summarizes the discussion so far.

.. <div style="width: 100%;">
..     <img src="images/SA_imaging.png" style="display: block; margin-left: auto; margin-right: auto; width: 70%;" alt="Synthetic Aperture Example Image">
..     <p style="text-align: center; font-style: italic">Fig. 1 - Synthetic Aperture Imaging</p>
.. </div>

Plane Wave Formulation
----------------------

In the previous paragraph, you received  the basic formulation of an SA. It is very important to underline that **PW is a different imaging technique but with the same expected outcome from the process of Beamformation**. PW imaging, in contrast with respect to SA imaging, excites all the transducers in the same moment to emit a plane wave, whose echos are registered by the whole number of transducers in our probe.
In PW, emission is called a single process of excitement of the whole transducers in the probe. As it happens in SA, every emission produces a LRI by the process of beamformation. An HRI could be obtained by compounding a set of LRIs, as it happens in SA. To have multiple emissions, a parameter called **span** is used, which represents an "aperture" angle and the directions in which you want to emit the plane waves. The span represent the total aperture of the investigation, and to determine the number of emission and the directions, an increment parameter is used, which represent how many areas with respect to the total angle you want to explore. Suppose you want to perform eight emissions with a spanning angle of 30 degrees. The investigations would be then be eight, starting from emitting a plane wave with direction of 0 degrees (or -15, depending on the system coordinates) and creating a LRI from the Beamformer. The second investigation would be an emission at 3.75 degrees direction (or -11.25, depending on the system coordinates), which is 0+3.75, where 3.75 represents the increment with respect to the emission made. You then obtain a second LRI from the Beamformer. This process is repeated until the eighth emission, and then the eight LRIs obtained compounded in a single HRI, as it happens in SA.
PW is, in terms of frame rate, the best choice for the process of beamformation. Opposite to SA, which needs a high number of emissions, **PW could be performed by a single emission** (at the cost of having an enormous load in terms data processing), because of the fact that it excites all (or nearly all) the transducers at the same moment. 
Following an image of summary of PW Imaging.

.. <div style="width: 100%;">
..     <img src="images/PlaneWave.png" style="display: block; margin-left: auto; margin-right: auto; width: 70%;" alt="Plane Wave Example Image">
..     <p style="text-align: center; font-style: italic">Fig. 2 - Plane Wave Image</p>
.. </div>

Learning the differences from Plane Wave and Synthetic Aperture
---------------------------------------------------------------

In the previous chapter and draws, two imaging techniques are introduced. It is important to understand how they're related to each other. The aim of this chapter is to detail Synthetic Aperture and re-write Plane Wave.
It is now going to be redrawn the SA step by step:

.. <div style="width: 100%;">
..     <img src="images/us-probe-sa-trasmitting.drawio.png" style="display: block; margin-left: auto; margin-right: auto; width: 70%;" alt="Emissions of Synthetic Aperture">
..     <p style="text-align: center; font-style: italic">Fig. 3 - SA: Single Emissions</p>
.. </div>

SA Formulation
--------------

 Some transducers (or just one, depending on design choices) are excited. The excitement produces a spherical wave, whose echoes are collected. Then, a second group of transducers is excited, the spherical wave emitted and then the echoes collected. This process is done by the number of times you want to generate single LRIs. The emissions drawn in the previous scheme are then collected and compounded together. 
Due to the nature of this process, the delay of emission can be computed and every emission can be focused in both transmission and reception (the usage of the **virtual sources** is explained later). The dynamic focusing in the reception is obtained by combining all the LRIs because the origin of the wave is know as well as the transducer(s), which generates it. Thus, the path Rx-Tx can be calculated. 
For this reason, due the sequential emission technique of SA, the insonification area created is focussed on the target:

.. <div style="width: 100%;">
..     <img src="images/fov_sa_focused.drawio.png" style="display: block; margin-left: auto; margin-right: auto; width: 70%;" alt="Emissions of Synthetic Aperture">
..     <p style="text-align: center; font-style: italic">Fig. 4 - SA focussed insonification area</p>
.. </div>

Every line represents the investigation of subgroup of transducer(s), "rectified" in the process of reception due to the sequential mode of emissions. 

On contrary, PW excites all the elements, as shown in figure 2. The insonification area cannot consequently be focused. Hence, it must be computed during the process of Beamforming. To eliminate the differences, perform the following three operations: 

1. Compute a delay for the reception for the transducers per line.
2. Focus the plane wave emitted on the direction of propagation (the cartesian system of the probe is explained in upcoming sections).
3. Modifying the formulation of the virtual sources to fit a different type of emission.

Performing this three operations rectifies the insonification by aligning a plane wave emitted (which should covers the overall area of transducers) and obtains the same result as the SA.